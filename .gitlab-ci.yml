# needs `curl`, `jq` 1.5 and `${PRIVATE_TOKEN}, cf.:
# - https://docs.gitlab.com/ee/api/#personal-access-tokens
# - https://docs.gitlab.com/ce/ci/variables/README.html#secret-variables
variables:
  GIT_SUBMODULE_STRATEGY: recursive
  CI_SERVER_URL: https://mygitlab.mycompany.com
before_script:
    - .monorepo.gitlab/last_green_commit.sh

stages:
  - build

build-a-unix:
  stage: build
  tags: unix
  # example for one liner (preferred) on linux
  script:
    - .monorepo.gitlab/build_if_changed.sh a cd a && cat README.md

build-a-windows:
  stage: build
  tags: windows
  # example for one liner (preferred) on windows
  script:
    - .monorepo.gitlab\build_if_changed.bat a cd a && type README.md

build-b:
  stage: build
  # example for multiple lines (discouraged) on linux
  script:
    - if [[ $(.monorepo.gitlab/changes.sh b) -ne 0]]; then echo "Skipping build for '${folder}'."; exit 0; fi
    - cd b
    - ls -hal
